-- Hex Hub GUI Script
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Mouse = LocalPlayer:GetMouse()

-- Create ScreenGui
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "HexHub"
screenGui.ResetOnSpawn = false
screenGui.Parent = game:GetService("CoreGui")

-- Main Frame
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 300, 0, 400)
mainFrame.Position = UDim2.new(0.5, -150, 0.5, -200)
mainFrame.BackgroundColor3 = Color3.fromRGB(0, 170, 0) -- Green
mainFrame.BorderSizePixel = 0
mainFrame.Parent = screenGui
mainFrame.Active = true
mainFrame.Draggable = true

-- Title Bar
local titleBar = Instance.new("Frame")
titleBar.Name = "TitleBar"
titleBar.Size = UDim2.new(1, 0, 0, 30)
titleBar.BackgroundColor3 = Color3.fromRGB(0, 140, 0)
titleBar.Parent = mainFrame

-- Title Text
local titleText = Instance.new("TextLabel")
titleText.Name = "TitleText"
titleText.Size = UDim2.new(1, -60, 1, 0)
titleText.Position = UDim2.new(0, 10, 0, 0)
titleText.BackgroundTransparency = 1
titleText.Text = "Hex Hub"
titleText.TextColor3 = Color3.new(1,1,1)
titleText.TextScaled = true
titleText.Font = Enum.Font.GothamBold
titleText.TextXAlignment = Enum.TextXAlignment.Left
titleText.Parent = titleBar

-- Close Button
local closeButton = Instance.new("TextButton")
closeButton.Name = "CloseButton"
closeButton.Size = UDim2.new(0, 30, 1, 0)
closeButton.Position = UDim2.new(1, -30, 0, 0)
closeButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
closeButton.Text = "X"
closeButton.TextColor3 = Color3.new(1,1,1)
closeButton.TextScaled = true
closeButton.Font = Enum.Font.GothamBold
closeButton.Parent = titleBar

closeButton.MouseButton1Click:Connect(function()
    screenGui.Enabled = false
end)

-- Minimize Button
local minimizeButton = Instance.new("TextButton")
minimizeButton.Name = "MinimizeButton"
minimizeButton.Size = UDim2.new(0, 30, 1, 0)
minimizeButton.Position = UDim2.new(1, -60, 0, 0)
minimizeButton.BackgroundColor3 = Color3.fromRGB(170, 170, 0)
minimizeButton.Text = "_"
minimizeButton.TextColor3 = Color3.new(1,1,1)
minimizeButton.TextScaled = true
minimizeButton.Font = Enum.Font.GothamBold
minimizeButton.Parent = titleBar

local contentVisible = true
minimizeButton.MouseButton1Click:Connect(function()
    contentVisible = not contentVisible
    for _, child in pairs(mainFrame:GetChildren()) do
        if child ~= titleBar then
            child.Visible = contentVisible
        end
    end
    if contentVisible then
        mainFrame.Size = UDim2.new(0, 300, 0, 400)
    else
        mainFrame.Size = UDim2.new(0, 300, 0, 30)
    end
end)

-- Container for buttons
local buttonContainer = Instance.new("Frame")
buttonContainer.Name = "ButtonContainer"
buttonContainer.Size = UDim2.new(1, -20, 1, -50)
buttonContainer.Position = UDim2.new(0, 10, 0, 40)
buttonContainer.BackgroundTransparency = 1
buttonContainer.Parent = mainFrame

local UIListLayout = Instance.new("UIListLayout")
UIListLayout.Parent = buttonContainer
UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
UIListLayout.Padding = UDim.new(0, 8)

-- Helper function to create buttons with fitted text
local function createButton(name, text)
    local btn = Instance.new("TextButton")
    btn.Name = name
    btn.Size = UDim2.new(1, 0, 0, 40)
    btn.BackgroundColor3 = Color3.fromRGB(0, 140, 0)
    btn.TextColor3 = Color3.new(1,1,1)
    btn.Font = Enum.Font.GothamBold
    btn.TextScaled = true
    btn.TextWrapped = true
    btn.Text = text
    btn.Parent = buttonContainer
    return btn
end

-- Fly functionality
local flying = false
local flySpeed = 50
local playerCharacter = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local humanoid = playerCharacter:WaitForChild("Humanoid")
local rootPart = playerCharacter:WaitForChild("HumanoidRootPart")

local flyButton = createButton("FlyButton", "Fly")
flyButton.MouseButton1Click:Connect(function()
    flying = not flying
    if flying then
        local BodyVelocity = Instance.new("BodyVelocity")
        BodyVelocity.Name = "FlyVelocity"
        BodyVelocity.MaxForce = Vector3.new(1e5, 1e5, 1e5)
        BodyVelocity.Velocity = Vector3.new(0,0,0)
        BodyVelocity.Parent = rootPart

        local BodyGyro = Instance.new("BodyGyro")
        BodyGyro.Name = "FlyGyro"
        BodyGyro.MaxTorque = Vector3.new(1e5, 1e5, 1e5)
        BodyGyro.CFrame = rootPart.CFrame
        BodyGyro.Parent = rootPart

        local flyConnection
        flyConnection = game:GetService("RunService").Heartbeat:Connect(function()
            if not flying or not rootPart or not BodyVelocity or not BodyGyro then
                flyConnection:Disconnect()
                if BodyVelocity then BodyVelocity:Destroy() end
                if BodyGyro then BodyGyro:Destroy() end
                return
            end
            local moveDirection = Vector3.new()
            if Mouse.KeyDown:Wait() == "w" then
                moveDirection = moveDirection + workspace.CurrentCamera.CFrame.LookVector
            end
            if Mouse.KeyDown:Wait() == "s" then
                moveDirection = moveDirection - workspace.CurrentCamera.CFrame.LookVector
            end
            if Mouse.KeyDown:Wait() == "a" then
                moveDirection = moveDirection - workspace.CurrentCamera.CFrame.RightVector
            end
            if Mouse.KeyDown:Wait() == "d" then
                moveDirection = moveDirection + workspace.CurrentCamera.CFrame.RightVector
            end
            BodyVelocity.Velocity = moveDirection.Unit * flySpeed
            BodyGyro.CFrame = workspace.CurrentCamera.CFrame
        end)
    else
        local bv = rootPart:FindFirstChild("FlyVelocity")
        local bg = rootPart:FindFirstChild("FlyGyro")
        if bv then bv:Destroy() end
        if bg then bg:Destroy() end
    end
end)

-- ESP (Basic)
local espButton = createButton("ESPButton", "ESP")
local espEnabled = false
local espConnections = {}

espButton.MouseButton1Click:Connect(function()
    espEnabled = not espEnabled
    if espEnabled then
        for _, player in pairs(Players:GetPlayers()) do
            if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
                local highlight = Instance.new("BoxHandleAdornment")
                highlight.Name = "HexESP"
                highlight.Adornee = player.Character.HumanoidRootPart
                highlight.AlwaysOnTop = true
                highlight.ZIndex = 10
                highlight.Size = Vector3.new(4, 6, 2)
                highlight.Color3 = Color3.fromRGB(0, 255, 0)
                highlight.Transparency = 0.5
                highlight.Parent = player.Character.HumanoidRootPart

                table.insert(espConnections, highlight)
            end
        end
        -- Listen for new players
        espConnections[#espConnections+1] = Players.PlayerAdded:Connect(function(player)
            player.CharacterAdded:Connect(function(character)
                if espEnabled and character:FindFirstChild("HumanoidRootPart") then
                    local highlight = Instance.new("BoxHandleAdornment")
                    highlight.Name = "HexESP"
                    highlight.Adornee = character.HumanoidRootPart
                    highlight.AlwaysOnTop = true
                    highlight.ZIndex = 10
                    highlight.Size = Vector3.new(4, 6, 2)
                    highlight.Color3 = Color3.fromRGB(0, 255, 0)
                    highlight.Transparency = 0.5
                    highlight.Parent = character.HumanoidRootPart
                    table.insert(espConnections, highlight)
                end
            end)
        end)
    else
        for _, v in pairs(espConnections) do
            if typeof(v) == "Instance" then
                v:Destroy()
            elseif typeof(v) == "RBXScriptConnection" then
                v:Disconnect()
            end
        end
        espConnections = {}
    end
end)

-- Hitbox Expander
local hitboxButton = createButton("HitboxButton", "Hitbox Expander")
local hitboxEnabled = false

hitboxButton.MouseButton1Click:Connect(function()
    hitboxEnabled = not hitboxEnabled
    for _, player in pairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player.Character:FindFirstChild("Humanoid") then
            local hrp = player.Character.HumanoidRootPart
            if hitboxEnabled then
                hrp.Size = Vector3.new(10, 10, 10)
                hrp.Transparency = 0.5
            else
                hrp.Size = Vector3.new(2, 2, 1)
                hrp.Transparency = 1
            end
        end
    end
    -- Also update on new characters
    Players.PlayerAdded:Connect(function(player)
        player.CharacterAdded:Connect(function(character)
            wait(1)
            if hitboxEnabled and character:FindFirstChild("HumanoidRootPart") then
                local hrp = character.HumanoidRootPart
                hrp.Size = Vector3.new(10, 10, 10)
                hrp.Transparency = 0.5
            end
        end)
    end)
end)

-- Teleport to Players
local teleportButton = createButton("TeleportButton", "Teleport to Player")
local teleportMenu = Instance.new("Frame")
teleportMenu.Name = "TeleportMenu"
teleportMenu.Size = UDim2.new(0, 280, 0, 200)
teleportMenu.Position = UDim2.new(0, 10, 0, 150)
teleportMenu.BackgroundColor3 = Color3.fromRGB(0, 140, 0)
teleportMenu.Visible = false
teleportMenu.Parent = mainFrame

local tpCloseButton = Instance.new("TextButton")
tpCloseButton.Name = "CloseTPMenu"
tpCloseButton.Size = UDim2.new(0, 30, 0, 30)
tpCloseButton.Position = UDim2.new(1, -35, 0, 5)
tpCloseButton.BackgroundColor3 = Color3.fromRGB(170, 0, 0)
tpCloseButton.Text = "X"
tpCloseButton.TextColor3 = Color3.new(1,1,1)
tpCloseButton.TextScaled = true
tpCloseButton.Font = Enum.Font.GothamBold
tpCloseButton.Parent = teleportMenu

tpCloseButton.MouseButton1Click:Connect(function()
    teleportMenu.Visible = false
end)

local tpList = Instance.new("ScrollingFrame")
tpList.Name = "PlayerList"
tpList.Size = UDim2.new(1, -10, 1, -40)
tpList.Position = UDim2.new(0, 5, 0, 35)
tpList.BackgroundTransparency = 1
tpList.CanvasSize = UDim2.new(0, 0, 0, 0)
tpList.ScrollBarThickness = 6
tpList.Parent = teleportMenu

local tpLayout = Instance.new("UIListLayout")
tpLayout.Parent = tpList
tpLayout.SortOrder = Enum.SortOrder.LayoutOrder
tpLayout.Padding = UDim.new(0, 5)

local function refreshPlayerList()
    tpList:ClearAllChildren()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer then
            local pBtn = Instance.new("TextButton")
            pBtn.Size = UDim2.new(1, 0, 0, 30)
            pBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 0)
            pBtn.TextColor3 = Color3.new(1,1,1)
            pBtn.Font = Enum.Font.GothamBold
            pBtn.TextScaled = true
            pBtn.Text = player.Name
            pBtn.Parent = tpList

            pBtn.MouseButton1Click:Connect(function()
                if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and rootPart then
                    rootPart.CFrame = player.Character.HumanoidRootPart.CFrame + Vector3.new(0, 5, 0)
                end
            end)
        end
    end
    wait()
    tpList.CanvasSize = UDim2.new(0, 0, 0, tpLayout.AbsoluteContentSize.Y + 10)
end

teleportButton.MouseButton1Click:Connect(function()
    teleportMenu.Visible = not teleportMenu.Visible
    if teleportMenu.Visible then
        refreshPlayerList()
    end
end)
